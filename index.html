<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meteorología España - AEMET</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
                'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
                sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState } = React;

      // ✅ Íconos como componentes de React (SVG puros)
      const CloudIcon = ({ className = "w-10 h-10" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h8a4 4 0 004-4V6a2 2 0 00-2-2H7a2 2 0 00-2 2v9z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v4" />
        </svg>
      );

      const SunIcon = ({ className = "w-16 h-16" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M12 15a3 3 0 100-6 3 3 0 000 6z" />
        </svg>
      );

      const CloudRainIcon = ({ className = "w-16 h-16" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h8a4 4 0 004-4V6a2 2 0 00-2-2H7a2 2 0 00-2 2v9z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v4m0 4v.01" />
        </svg>
      );

      const CloudSnowIcon = ({ className = "w-16 h-16" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h8a4 4 0 004-4V6a2 2 0 00-2-2H7a2 2 0 00-2 2v9z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 12h.01M8 12h.01M16 12h.01" />
        </svg>
      );

      const CloudDrizzleIcon = ({ className = "w-16 h-16" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 15a4 4 0 004 4h8a4 4 0 004-4V6a2 2 0 00-2-2H7a2 2 0 00-2 2v9z" />
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4v.01" />
        </svg>
      );

      const DropletsIcon = ({ className = "w-12 h-12" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2m0-8v6m0 0v2a1.5 1.5 0 003 0V14m-3-6h6" />
        </svg>
      );

      const WindIcon = ({ className = "w-10 h-10" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" />
        </svg>
      );

      const SearchIcon = ({ className = "w-5 h-5" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
        </svg>
      );

      const MapPinIcon = ({ className = "w-4 h-4" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 12.414a2 2 0 00-2.828 0L6.343 16.657A2 2 0 008 20h8a2 2 0 001.657-3.343zM12 6a4 4 0 100 8 4 4 0 000-8z" />
        </svg>
      );

      const LoaderIcon = ({ className = "w-12 h-12" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
        </svg>
      );

      const AlertIcon = ({ className = "w-5 h-5" }) => (
        <svg xmlns="http://www.w3.org/2000/svg" className={className} fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.764 6.173c-.77-.833-1.99-1.167-2.828-.335L2.336 15.5c-.77.833-.207 2.5.882 2.5z" />
        </svg>
      );

      // ✅ URL CORREGIDA (sin espacios al final)
      const PROXY_URL = 'https://aemet-proxy-palcaraz366-maker.vercel.app/api/weather';

      const AemetWeatherApp = () => {
        const [loading, setLoading] = useState(false);
        const [error, setError] = useState('');
        const [searchTerm, setSearchTerm] = useState('');
        const [selectedCity, setSelectedCity] = useState(null);
        const [weatherData, setWeatherData] = useState(null);
        const [forecastData, setForecastData] = useState(null);

        const cities = [
          { name: 'Madrid', code: '28079', province: 'Madrid' },
          { name: 'Barcelona', code: '08019', province: 'Barcelona' },
          { name: 'Valencia', code: '46250', province: 'Valencia' },
          { name: 'Sevilla', code: '41091', province: 'Sevilla' },
          { name: 'Zaragoza', code: '50297', province: 'Zaragoza' },
          { name: 'Málaga', code: '29067', province: 'Málaga' },
          { name: 'Murcia', code: '30030', province: 'Murcia' },
          { name: 'Palma de Mallorca', code: '07040', province: 'Illes Balears' },
          { name: 'Las Palmas', code: '35016', province: 'Las Palmas' },
          { name: 'Bilbao', code: '48020', province: 'Bizkaia' },
          { name: 'Alicante', code: '03014', province: 'Alicante' },
          { name: 'Córdoba', code: '14021', province: 'Córdoba' },
          { name: 'Valladolid', code: '47186', province: 'Valladolid' },
          { name: 'Vigo', code: '36057', province: 'Pontevedra' },
          { name: 'Gijón', code: '33044', province: 'Asturias' },
          { name: 'Granada', code: '18087', province: 'Granada' },
          { name: 'A Coruña', code: '15030', province: 'A Coruña' },
          { name: 'Vitoria-Gasteiz', code: '01059', province: 'Araba/Álava' },
          { name: 'Santa Cruz de Tenerife', code: '38038', province: 'Santa Cruz de Tenerife' },
          { name: 'Pamplona', code: '31201', province: 'Navarra' },
          { name: 'Santander', code: '39075', province: 'Cantabria' },
          { name: 'Toledo', code: '45168', province: 'Toledo' },
          { name: 'Badajoz', code: '06015', province: 'Badajoz' },
          { name: 'Logroño', code: '26089', province: 'La Rioja' },
          { name: 'Salamanca', code: '37274', province: 'Salamanca' },
          { name: 'Tarragona', code: '43148', province: 'Tarragona' },
          { name: 'Lleida', code: '25120', province: 'Lleida' },
          { name: 'Castellón', code: '12040', province: 'Castellón' },
          { name: 'Cádiz', code: '11012', province: 'Cádiz' },
          { name: 'Huelva', code: '21041', province: 'Huelva' },
          { name: 'Almería', code: '04013', province: 'Almería' },
          { name: 'Albacete', code: '02003', province: 'Albacete' },
          { name: 'Cáceres', code: '10037', province: 'Cáceres' },
          { name: 'Jaén', code: '23050', province: 'Jaén' },
          { name: 'Ourense', code: '32054', province: 'Ourense' },
          { name: 'Guadalajara', code: '19130', province: 'Guadalajara' },
          { name: 'León', code: '24089', province: 'León' },
          { name: 'Burgos', code: '09059', province: 'Burgos' },
          { name: 'Segovia', code: '40194', province: 'Segovia' },
          { name: 'Ávila', code: '05019', province: 'Ávila' }
        ];

        const filteredCities = cities.filter(city =>
          city.name.toLowerCase().includes(searchTerm.toLowerCase())
        );

        const fetchWeatherData = async (city) => {
          setLoading(true);
          setError('');
          try {
            const response = await fetch(`${PROXY_URL}?cityCode=${city.code}`);
            if (!response.ok) {
              const err = await response.json().catch(() => ({}));
              throw new Error(err.error || 'Error al cargar el pronóstico');
            }
            const forecast = await response.json();
            setForecastData(forecast[0]);
            setWeatherData({
              city: city.name,
              province: city.province,
              updated: new Date().toLocaleString('es-ES')
            });
          } catch (err) {
            console.error('Error:', err);
            setError(`Error: ${err.message}`);
          } finally {
            setLoading(false);
          }
        };

        const handleCitySelect = (city) => {
          setSelectedCity(city);
          fetchWeatherData(city);
        };

        const getWeatherIcon = (estado) => {
          if (!estado) return <CloudIcon className="w-16 h-16 text-gray-400" />;
          const descripcion = estado.toLowerCase();
          if (descripcion.includes('despejado') || descripcion.includes('sol') || descripcion.includes('cielo claro')) {
            return <SunIcon className="w-16 h-16 text-yellow-400" />;
          } else if (descripcion.includes('lluvia') || descripcion.includes('chubasco')) {
            return <CloudRainIcon className="w-16 h-16 text-blue-400" />;
          } else if (descripcion.includes('nieve')) {
            return <CloudSnowIcon className="w-16 h-16 text-blue-200" />;
          } else if (descripcion.includes('llovizna') || descripcion.includes('lluvia débil')) {
            return <CloudDrizzleIcon className="w-16 h-16 text-blue-300" />;
          }
          return <CloudIcon className="w-16 h-16 text-gray-400" />;
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-400 via-blue-500 to-blue-600 p-4">
            <div className="max-w-6xl mx-auto">
              <div className="text-center mb-8 pt-8">
                <h1 className="text-4xl font-bold text-white mb-2 flex items-center justify-center gap-3">
                  <CloudIcon className="w-10 h-10" />
                  Meteorología España - AEMET
                </h1>
                <p className="text-blue-100">Datos oficiales (vía proxy seguro)</p>
              </div>

              <div className="grid md:grid-cols-3 gap-6">
                <div className="md:col-span-1">
                  <div className="bg-white rounded-xl shadow-2xl p-6">
                    <div className="mb-4">
                      <div className="relative">
                        <SearchIcon className="absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 w-5 h-5" />
                        <input
                          type="text"
                          placeholder="Buscar ciudad..."
                          value={searchTerm}
                          onChange={(e) => setSearchTerm(e.target.value)}
                          className="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                        />
                      </div>
                    </div>

                    <div className="space-y-2 max-h-96 overflow-y-auto">
                      {filteredCities.map((city) => (
                        <button
                          key={city.code}
                          onClick={() => handleCitySelect(city)}
                          className={`w-full text-left px-4 py-3 rounded-lg transition-all ${
                            selectedCity?.code === city.code
                              ? 'bg-blue-500 text-white shadow-md'
                              : 'bg-gray-50 hover:bg-gray-100 text-gray-700'
                          }`}
                        >
                          <div className="flex items-center gap-2">
                            <MapPinIcon className="w-4 h-4" />
                            <div>
                              <div className="font-medium">{city.name}</div>
                              <div className={`text-xs ${
                                selectedCity?.code === city.code ? 'text-blue-100' : 'text-gray-500'
                              }`}>
                                {city.province}
                              </div>
                            </div>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>
                </div>

                <div className="md:col-span-2">
                  <div className="bg-white rounded-xl shadow-2xl p-6">
                    {!selectedCity && !loading && (
                      <div className="text-center py-16">
                        <CloudIcon className="w-20 h-20 text-gray-300 mx-auto mb-4" />
                        <p className="text-gray-500 text-lg">Selecciona una ciudad para ver el pronóstico</p>
                      </div>
                    )}

                    {loading && (
                      <div className="text-center py-16">
                        <LoaderIcon className="text-blue-500 animate-spin mx-auto mb-4" />
                        <p className="text-gray-600">Cargando datos meteorológicos...</p>
                      </div>
                    )}

                    {error && (
                      <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                        <div className="flex items-center gap-2 text-red-700">
                          <AlertIcon className="w-5 h-5" />
                          <p>{error}</p>
                        </div>
                      </div>
                    )}

                    {weatherData && forecastData && !loading && (
                      <div>
                        <div className="border-b border-gray-200 pb-4 mb-6">
                          <h2 className="text-3xl font-bold text-gray-800 flex items-center gap-2">
                            <MapPinIcon className="w-8 h-8 text-blue-500" />
                            {weatherData.city}
                          </h2>
                          <p className="text-gray-500 mt-1">{weatherData.province}</p>
                        </div>

                        {forecastData.prediccion?.dia?.[0] && (
                          <div className="mb-6">
                            <h3 className="text-xl font-semibold text-gray-800 mb-4">Predicción para hoy</h3>
                            <div className="grid md:grid-cols-2 gap-4 mb-6">
                              <div className="bg-gradient-to-br from-orange-50 to-red-50 rounded-lg p-4">
                                <p className="text-sm text-gray-600 mb-1">Temperatura</p>
                                <div className="flex items-baseline gap-2">
                                  <span className="text-3xl font-bold text-orange-600">
                                    {forecastData.prediccion.dia[0].temperatura?.maxima || '--'}°
                                  </span>
                                  <span className="text-xl text-gray-500">
                                    / {forecastData.prediccion.dia[0].temperatura?.minima || '--'}°
                                  </span>
                                </div>
                              </div>
                              <div className="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg p-4">
                                <p className="text-sm text-gray-600 mb-1">Humedad</p>
                                <div className="flex items-baseline gap-2">
                                  <span className="text-3xl font-bold text-blue-600">
                                    {forecastData.prediccion.dia[0].humedadRelativa?.maxima || '--'}%
                                  </span>
                                  <span className="text-xl text-gray-500">
                                    / {forecastData.prediccion.dia[0].humedadRelativa?.minima || '--'}%
                                  </span>
                                </div>
                              </div>
                            </div>

                            {forecastData.prediccion.dia[0].estadoCielo?.[0] && (
                              <div className="bg-gray-50 rounded-lg p-4 mb-4">
                                <div className="flex items-center gap-4">
                                  {getWeatherIcon(forecastData.prediccion.dia[0].estadoCielo[0].descripcion)}
                                  <div>
                                    <p className="text-sm text-gray-600 mb-1">Estado del cielo</p>
                                    <p className="text-lg font-semibold text-gray-800">
                                      {forecastData.prediccion.dia[0].estadoCielo[0].descripcion}
                                    </p>
                                  </div>
                                </div>
                              </div>
                            )}

                            {forecastData.prediccion.dia[0].viento?.[0] && (
                              <div className="bg-gray-50 rounded-lg p-4">
                                <div className="flex items-center gap-4">
                                  <WindIcon className="w-10 h-10 text-gray-500" />
                                  <div>
                                    <p className="text-sm text-gray-600 mb-1">Viento</p>
                                    <p className="text-lg font-semibold text-gray-800">
                                      {forecastData.prediccion.dia[0].viento[0].direccion || '--'} - {forecastData.prediccion.dia[0].viento[0].velocidad || '--'} km/h
                                    </p>
                                  </div>
                                </div>
                              </div>
                            )}
                          </div>
                        )}

                        {forecastData.prediccion?.dia?.length > 1 && (
                          <div>
                            <h3 className="text-xl font-semibold text-gray-800 mb-4">Próximos días</h3>
                            <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                              {forecastData.prediccion.dia.slice(1, 7).map((dia, idx) => (
                                <div key={dia.fecha} className="bg-gray-50 rounded-lg p-3">
                                  <p className="text-xs text-gray-600 mb-2">
                                    {new Date(dia.fecha).toLocaleDateString('es-ES', { 
                                      weekday: 'short', 
                                      day: 'numeric',
                                      month: 'short'
                                    })}
                                  </p>
                                  <div className="flex justify-between items-center">
                                    <div>
                                      <span className="text-lg font-bold text-orange-600">
                                        {dia.temperatura?.maxima || '--'}°
                                      </span>
                                      <span className="text-sm text-gray-500 ml-1">
                                        / {dia.temperatura?.minima || '--'}°
                                      </span>
                                    </div>
                                    {dia.estadoCielo?.[0] && (
                                      <div className="w-8 h-8">
                                        {getWeatherIcon(dia.estadoCielo[0].descripcion)}
                                      </div>
                                    )}
                                  </div>
                                </div>
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </div>
              </div>

              <div className="text-center mt-8 pb-8">
                <p className="text-blue-100 text-sm">Datos proporcionados por AEMET</p>
              </div>
            </div>
          </div>
        );
      };

      ReactDOM.createRoot(document.getElementById('root')).render(<AemetWeatherApp />);
    </script>
</body>
</html>
